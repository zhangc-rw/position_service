  <!DOCTYPE html>
  <!--
  This is a starter template page. Use this page to start your new project from
  scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <title>大坝位移监测系统</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <link rel="stylesheet" href="../../../../static/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../../../../static/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="../../../../static/css/ionicons.min.css">
  <!-- DataTables -->
  <link rel="stylesheet" href="../../../../static/css/dataTables.bootstrap.min.css">
  <!-- daterange picker -->
  <link rel="stylesheet" href="../../../../static/css/daterangepicker.css">
  <!-- bootstrap datepicker -->
  <link rel="stylesheet" href="../../../../static/css/bootstrap-datepicker.min.css">
  <!-- Bootstrap time Picker -->
  <link rel="stylesheet" href="../../../../static/css/bootstrap-timepicker.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../../../../static/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect. -->
          <link rel="stylesheet" href="../../../../static/css/skin-blue.min.css">
          <link rel="stylesheet" href="../../../../static/css/form.css">
          <link rel="stylesheet" href="../../../../static/css/_all-skins.min.css">
          <!-- Select2 -->
          <link rel="stylesheet" href="../../../../static/css/select2.min.css">

          <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
          <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <style type="text/css">
  body, html {
    width: 100%;
    height: 100%;
    margin: 0;
    font-family: "微软雅黑";
  }
  #allmap {
    height: 500px;
    width: 100%;
  }
  #r-result {
    width: 100%;
  }
  .submit_loading {
    position:fixed;
    width:100%;
    height:100%;
    top:0;
    left:0;
    background-color:#000;
    text-align:center;
    opacity:0.3;
  }
  .loading_show {
    margin-top:30%;
  }
  .loading_context {
    color:#fff;
  </style>
  <!-- Google Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
</head>
  <!--
  BODY TAG OPTIONS:
  =================
  Apply one or more of the following classes to get the
  desired effect
  |---------------------------------------------------------|
  | SKINS         | skin-blue                               |
  |               | skin-black                              |
  |               | skin-purple                             |
  |               | skin-yellow                             |
  |               | skin-red                                |
  |               | skin-green                              |
  |---------------------------------------------------------|
  |LAYOUT OPTIONS | fixed                                   |
  |               | layout-boxed                            |
  |               | layout-top-nav                          |
  |               | sidebar-collapse                        |
  |               | sidebar-mini                            |
  |---------------------------------------------------------|
-->

<body class="hold-transition skin-blue sidebar-mini">
  <div class="wrapper"> 

    <!-- Main Header -->
    <header class="main-header"> 

      <!-- Logo --> 
      <a href="#" class="logo"> 
        <!-- mini logo for sidebar mini 50x50 pixels --> 
        <span class="logo-mini">监测系统</span> 
        <!-- logo for regular state and mobile devices --> 
        <span class="logo-lg">大坝位移监测系统</span> </a> 
        
        <!-- Header Navbar -->
        <nav class="navbar navbar-../../../static-top" role="navigation"> 
          <!-- Sidebar toggle button--> 
          <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button"> <span class="sr-only">Toggle navigation</span> </a> 
          <!-- Navbar Right Menu -->
          <div class="navbar-custom-menu">
            <ul class="nav navbar-nav">
              <!-- User Account Menu -->
              <li class="dropdown user user-menu"> 
                <!-- Menu Toggle Button --> 
              <!--
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"> 
                <!-- The user image in the navbar--> 
              <!--
              <img src="../../../static/img/user2-160x160.jpg" class="user-image" alt="User Image"> 
              <!-- hidden-xs hides the username on small devices so only the image appears. --> 
              <!--
              <span class="hidden-xs">Alexander Pierce</span> </a>
            -->
            <ul class="dropdown-menu">
              <!-- The user image in the menu -->
              <li class="user-header"> <img src="../../../static/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                <p> Alexander Pierce - Web Developer <small>Member since Nov. 2012</small> </p>
              </li>
              <!-- Menu Body -->
              <li class="user-body">
                <div class="row">
                  <div class="col-xs-4 text-center"> <a href="#">Followers</a> </div>
                  <div class="col-xs-4 text-center"> <a href="#">Sales</a> </div>
                  <div class="col-xs-4 text-center"> <a href="#">Friends</a> </div>
                </div>
                <!-- /.row --> 
              </li>
              <!-- Menu Footer-->
              <li class="user-footer">
                <div class="pull-left"> <a href="#" class="btn btn-default btn-flat">Profile</a> </div>
                <div class="pull-right"> <a href="#" class="btn btn-default btn-flat">Sign out</a> </div>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar"> 

    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar"> 
      <!-- Sidebar Menu -->
      <ul class="sidebar-menu" data-widget="tree">
        <!-- Optionally, you can add icons to the links -->
        <li>
          <a href="/Dam_Device_management/DandL_management">
            <i class="fa fa-edit"></i> <span>设备管理</span>
          </a>
        </li>
        <li class="treeview">
          <a href="#">
            <i class="fa fa-pie-chart"></i>
            <span>查询统计</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li><a href="/Dam_Device_management/history_search"><i class="fa fa-circle-o"></i>监测历史数据查询</a></li>
            <li><a href="/Dam_Device_management/realTime_search"><i class="fa fa-circle-o"></i>监测实时数据查询</a></li>
          </ul>
        </li>
        <li class="active treeview menu-open">
          <a href="#">
            <i class="fa fa-table"></i>
            <span>数据管理</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li class="active"><a href="/Dam_Device_management/list_show_history"><i class="fa fa-circle-o"></i>监测历史数据查询</a></li>
            <li><a href="/Dam_Device_management/list_show_realTime"><i class="fa fa-circle-o"></i>监测实时数据查询</a></li>
          </ul>
        </li>
      </ul>
      <!-- /.sidebar-menu --> 
    </section>
    <!-- /.sidebar --> 
  </aside>
  
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper"> 
    <!-- Main content -->
    <section class="content container-fluid">
      <div class="row">
        <div class="col-md-12"> 
          <!-- Custom Tabs (Pulled to the right) -->
          <div class="nav-tabs-custom">
            <ul class="nav nav-tabs pull-right">
              <li class="active"><a href="#tab_labelManagement" data-toggle="tab">测试点设备列表</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="tab_labelManagement">  
                <!-- Main content -->
                <section class="content">
                  <div class="row">
                    <div class="col-xs-12">
                      <button type="button" class="btn btn-info pull-right" id="save">查询</button>
                    </div>
                    <div class="col-xs-12">
                      <div class="box">
                        <table id="dataList" class="table table-bordered table-hover tabTable">
                          <tr>
                            <th>大坝编号</th>
                            <th>基站编号A</th>
                            <th>标签编号T</th>
                            <th>时间</th>
                            <th>温度</th>
                            <th>原始数据</th>
                          </tr>
                          <tr>
                            <td><select input type="varchar" class="form-control form-input dam_num" name="dam_num" id="dam_num" style="width: 100%;">
                            </select></td>
                            <td><select input type="varchar" class="form-control form-input station_num" name="station_num" id="station_num" style="width: 100%;">
                            </select></td>
                            <td><select input type="varchar" class="form-control form-input device_num" name="device_num" id="device_num" style="width: 100%;">
                            </select></td>
                            <td><input type="varchar" class="form-control form-input reservationtime" name="reservationtime" id="reservationtime" style="width: 100%">
                            </td>
                            <td><select input type="varchar" class="form-control form-input" name="temperature_num" id="temperature_num" style="width: 100%;">
                              <option>是</option>
                              <option>否</option>
                            </select></td>
                            <td><select input type="varchar" class="form-control form-input" name="raw_num" id="raw_num" style="width: 100%;">
                              <option>是</option>
                              <option>否</option>
                            </select></td>
                          </tr>
                          <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="time"></td>
                            <td class="temperature"></td>
                            <td class="raw_num"></td>
                          </tr>
                        </table>
                      </div>
                      <!-- /.box --> 
                      <div id="sending" class="submit_loading" style="visibility: hidden">
                        <div class="loading_show">
                          <img src="../../../../../static/img/5-121204194114.gif">
                          <p class="loading_context">正在提交，请稍候。</p>
                        </div>
                      </div>
                      <!-- /.sending -->
                    </div>
                    <!-- /.col --> 
                  </div>
                  <!-- /.row --> 
                </section>
                <!-- /.content --> 
              </div>
            </div>
            <!-- /.tab-content --> 
          </div>
          <!-- nav-tabs-custom --> 
        </div>
        <!-- /.col --> 
      </div>
    </section>
    <!-- /.content --> 
  </div>
  <!-- /.content-wrapper --> 
</div>
<!-- ./wrapper --> 

<!-- REQUIRED JS SCRIPTS --> 

<!-- jQuery 3 --> 
<script src="../../../../static/js/jquery.min.js"></script> 
<!-- Bootstrap 3.3.7 --> 
<script src="../../../../static/js/bootstrap.min.js"></script> 
<!-- DataTables --> 
<script src="../../../../static/js/jquery.dataTables.min.js"></script> 
<script src="../../../../static/js/dataTables.bootstrap.min.js"></script> 
<!-- date-range-picker --> 
<script src="../../../../static/js/moment.min.js"></script> 
<script src="../../../../static/js/daterangepicker.js"></script> 
<!-- bootstrap datepicker --> 
<script src="../../../../static/js/bootstrap-datepicker.min.js"></script> 
<!-- bootstrap time picker --> 
<script src="../../../../static/js/bootstrap-timepicker.min.js"></script> 
<!-- AdminLTE App --> 
<script src="../../../../static/js/adminlte.min.js"></script> 
<script src="../../../../static/js/form.js"></script> 
<!-- vue --> 
<script src="../../../../static/js/vue.js"></script> 
<script src="../../../../static/js/csrf.js"></script> 
<script src="../../../../static/js/fastclick.js"></script> 
<!-- AdminLTE for demo purposes --> 
<script src="../../../../static/js/demo.js"></script> 
<!-- Select2 --> 
<script src="../../../../static/js/select2.full.min.js"></script> 

  <!-- Optionally, you can add Slimscroll and FastClick plugins.
       Both of these plugins are recommended to enhance the
       user experience. --> 
       
       <script>
        $(document).ready(function(){
          $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}' },  
          }); 

    //Date range picker with time picker
    $('.reservationtime').daterangepicker({
      timePicker: true,
      timePickerIncrement: 10,
          // ranges: {
          //   "今天": [moment(), moment()],
          //   "昨天": [moment().subtract(1,'days'), moment().subtract(1,'days')],
          //   "过去七天": [moment().subtract(6,'days'), moment()],
          //   "本月": [moment().startOf('month'), moment()],
          //   "上月": [moment().subtract(1,'month').startOf('month'), moment().subtract(1,'month').endOf('month')],
          //   "过去三个月": [moment().subtract(3,'month').startOf('month'), moment().subtract(3,'month').endOf('month')],
          //   "去年": [moment().subtract(1,'year').startOf('year'), moment().subtract(1,'year').endOf('year')]
          // },
          "locale": {
            format: 'YYYY-MM-DD HH:mm',
            //format: 'YYYY-MM-DD',
            applyLabel: "应用",
            cancelLabel: "取消",
            resetLabel: "重置",
            customRangeLabel: "自定义",
            daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
            monthNames: ['一月', '二月', '三月', '四月', '五月', '六月','七月', '八月', '九月', '十月', '十一月', '十二月'],
          }
        })

    //将大坝、基站和标签的list传至js，显示在前端的第一行列表
    var dam_num_list={{dam_num_list|safe}};
    var station_num_list={{station_num_list|safe}};
    var device_num_list={{device_num_list|safe}};
    var station_num_total_list={{station_num_total_list|safe}};
    var device_num_total_list={{device_num_total_list|safe}};
    //console.log(device_num_list)

      //根据大坝数量，分配大坝，基站和标签数组
      for (var i = 0; i < dam_num_list.length; i++) {
        window["dam_num"+i] = [];//实际使用大坝列表
        window["station_num"+i] = [];//实际使用基站列表
        window["device_num"+i] = [];//实际使用标签列表
      }

      //赋值
      var start_station = 0;
      var start_device = 0;
      for (var i = 0; i < dam_num_list.length; i++) {
        window["station_num"+i] = station_num_list.slice(start_station,start_station + station_num_total_list[i]);
        window["device_num"+i] = device_num_list.slice(start_device,start_device + device_num_total_list[i]);
        start_station = start_station + station_num_total_list[i];
        start_device = start_device + device_num_total_list[i];
        //console.log(window["station_num"+i])
        //console.log(window["device_num"+i])
      }

      //显示dam 注意添加option的方法1
      var htmlDam = '<option>'+ '-请选择-' +'</option>';
      for(var i = 0;i < dam_num_list.length;i++){
        htmlDam+='<option>'+ dam_num_list[i] +'</option>';//字符串组，而不是push成数组
        //回传至html相应位置， parents是用来找父级，comparisonShow已经在最外面了就不用了
        $('#tab_labelManagement').find(".dam_num").html(htmlDam); 
      } 

      //大坝与基站标签联动
      //查找两个select
      var selDam = document.getElementsByClassName("dam_num")[0];
      var selStation = document.getElementsByClassName("station_num")[0];
      var selDevice = document.getElementsByClassName("device_num")[0];
      //为selDam绑定选中项改变事件
      selDam.onchange = function liandong(){
      //获得当前select选中项的下标
      var i = this.selectedIndex;
        //console.log(i)
        if(i > 0){
          var j = i-1;//不能表示为window["station_num"+i-1]
          //获得window["station_num"+i],window["device_num"+i]数组中i-1位置的子数组
          var station = window["station_num"+j];
          var device = window["device_num"+j];
          //console.log(station)
          //清空selStation,selDevice的内容:
          selStation.innerHTML="";
          selDevice.innerHTML="";
          //显示基站标签在append里
          var arrStation = '';
          var arrDevice = '';
          //创建文档片段
          var frag_station = document.createDocumentFragment();
          var frag_device = document.createDocumentFragment();
          //创建一个option，内容为-请选择-,追加到selStation下，注意添加option的方法2
          var opt_station = document.createElement("option");
          opt_station.innerHTML="-请选择-";
          frag_station.appendChild(opt_station);
          var opt_device = document.createElement("option");
          opt_device.innerHTML="-请选择-";
          frag_device.appendChild(opt_device);
          //遍历station中每个基站，device中每个标签
          for(var i=0;i<station.length;i++){
            //创建一个option，设置其内容为当前station，追加到selStation中
            var opt_station = document.createElement("option");
            //console.log(opt_station)
            opt_station.innerHTML=station[i];
            frag_station.appendChild(opt_station);
          }
          //console.log(arrStation)
          for(var i=0;i<device.length;i++){
            //创建一个option，设置其内容为当前device，追加到selDevice中
            var opt_device = document.createElement("option");
            opt_device.innerHTML=device[i];
            frag_device.appendChild(opt_device);
          }
          //console.log(arrDevice)
          //将frag整体追加到selStation,selDevice中
          selStation.appendChild(frag_station);
          selDevice.appendChild(frag_device);
          //console.log(selStation)
        } 
      }

    //ajax实现前后交互
      //获取前端选择项
      $("#dam_num").change(function(){ 
        var arr_dam = [];
        arr_dam.push($(this).children('option:selected').val());
        //console.log(arr_dam);
        var dam_num = JSON.stringify(arr_dam);
        //console.log(dam_num)
      })
      $("#station_num").change(function(){ 
        var arr_station = [];
        arr_station.push($(this).children('option:selected').val());
        //console.log(arr_station);
        var station_num = JSON.stringify(arr_station);
        //console.log(station_num)
      })
      $("#device_num").change(function(){ 
        var arr_device = [];
        arr_device.push($(this).children('option:selected').val());
        //console.log(arr_device);
        var device_num = JSON.stringify(arr_device);
        //console.log(device_num)
      })
      $("#reservationtime").change(function(){
        var arr_reservationtime = [];
        arr_reservationtime.push($("#reservationtime").val());
        //console.log(arr_reservationtime);
        var reservationtime = JSON.stringify(arr_reservationtime);
        //console.log(reservationtime)
      })
      $("#temperature_num").change(function(){
        var arr_temperature = [];
        arr_temperature.push($("#temperature_num").val());
        //console.log(arr_temperature);
        var temperature_num = JSON.stringify(arr_temperature);
        //console.log(temperature_num)
      })
      $("#raw_num").change(function(){
        var arr_raw = [];
        arr_raw.push($("#raw_num").val());
        //console.log(arr_raw);
        var raw_num = JSON.stringify(arr_raw);
        //console.log(raw_num)
      })
      
      //点击“查询”，触发ajax交互
      $("#save").bind("click",function(){
        //console.log(dam_num)
        $.ajax({
          url:"/../Displacement_management/label_detail_raw_history/",
          type:"POST",
          dataType: "JSON",
          data: {"dam_num":dam_num.value,"station_num":station_num.value,"device_num":device_num.value,"reservationtime":reservationtime.value,"temperature_num":temperature_num.value,"raw_num":raw_num.value},
          traditional: true,
          success:function(result){
            //alert("正确！！");
            //console.log(result.Time_list)
            //console.log(result.Data_list_temperature)
            //console.log(result.Data_list_raw)
            //回传至html相应位置， parents是用来找父级，datalist已经在最外面了就不用了
            $('#dataList').find(".time").html(result.Time_list.join('<br>'))
            $('#dataList').find(".temperature").html(result.Data_list_temperature.join('<br>'))
            $('#dataList').find(".raw_num").html(result.Data_list_raw.join('<br>'))
            
            sending.style.visibility="hidden";
          },
          error:function(e){
            alert("错误！！");
          }
        })        
      }) 
      $("#save").bind("click",function(){
        sending.style.visibility="visible"; 
      })
    }) 
  </script>
</body>
</html>